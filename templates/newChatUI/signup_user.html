{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title> Sign Up Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully responsive section which can be used to form" name="description" />
    <meta content="Techzaa" name="author" />
    <link rel="shortcut icon" href="assets/images/favicon.svg">

    <!-- tabler css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
    <!-- Style css -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css">

<style>
    #spinner-overlay {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

#content {
    display: none;
}
</style>

</head>
<body>
    <div id="spinner-overlay">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    <section class="px-10 py-10 flex items-center justify-center" id="content">
        <div class="container">
            <img src="" class="h-6 mx-auto" alt="">
            <div class="max-w-4xl p-6 mx-auto bg-gray-50 rounded-md drop-shadow-md mt-10">
                <h1 class="text-xl font-bold text-gray-700 capitalize text-center">Sign Up for an Account</h1>
                <form>
                    <div class="grid grid-cols-1 gap-6 mt-4 md:grid-cols-2">
                        <!-- Full Name -->
                        <div>
                            <label class="text-gray-700" for="fullName">Full Name (as per Aadhar Card)</label>
                            <input id="name" placeholder="Enter your Name" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Contact Number -->
                        <div>
                            <label class="text-gray-700" for="contact1">Contact Number</label>
                            <input  id="contact1" placeholder="Enter your contact 1" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Alternate Contact Number -->
                        <div>
                            <label class="text-gray-700" for="contact2">Alternate Contact Number</label>
                            <input id="contact2" placeholder="Enter your contact 2" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Email -->
                        <div>
                            <label class="text-gray-700" for="email">Email address</label>
                            <input id="email" placeholder="Enter your email" type="email" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Upload Aadhar Card Front -->
                        <div>
                            <label class="text-gray-700" for="aadhar_front">Upload Aadhar Card (Front)</label>
                            <input id="aadhar_front" type="file" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Upload Aadhar Card Back -->
                        <div>
                            <label class="text-gray-700" for="aadhar_back">Upload Aadhar Card (Back)</label>
                            <input id="aadhar_back" type="file" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>
                        
                        <div>
                            <label class="text-gray-700" for="pan_card">Pan Number</label>
                            <input id="pan_card" type="file" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <div>
                            <label class="text-gray-700" for="pan_card_number">Upload Pan Card</label>
                            <input id="pan_card_number" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Occupation -->
                        <div>
                            <label class="text-gray-700" for="occupation">Occupation</label>
                            <select id="occupation" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                                <option value="0">Select...</option>
                                <option value="1">Student</option>
                                <option value="2">Salaried</option>
                                <option value="3">Self-Employed</option>
                                <option value="4">Others</option>
                            </select>
                        </div>

                        <!-- Dynamic fields (Initially hidden) -->
                        <div id="dynamicFields" class="grid grid-rows-2 gap-6" style="display:none"></div>

                        <!-- Date of Birth -->
                        <div>
                            <label class="text-gray-700" for="dateofbirth">Date of Birth</label>
                            <input id="date_of_birth" type="date" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- DC Code -->
                        <div>
                            <label class="text-gray-700" for="DCcode">DC Code</label>
                            <input id="dc_Code" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Profile Picture -->

                        <div>
                            <label class="text-gray-700" for="captured-image">Profile Picture</label>
                            <input type="file" id="captured-image-file" name="captured-image" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>
                        
                        <!-- Password -->
                        <div>
                            <label class="text-gray-700" for="password">Password</label>
                            <input id="password" type="password" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- Confirm Password -->
                        <div>
                            <label class="text-gray-700" for="password2">Confirm Password</label>
                            <input id="password2" type="password" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>

                        <!-- System IP Address -->
                        <div>
                            <label class="text-gray-700" for="systemIp">System IP Address</label>
                            <input id="systemipaddress" name="SystemIPAddress" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                        </div>
                    </div>

                    <div class="flex justify-center mt-6">
                        <button type="submit" id="sign_up" class="px-6 py-2 leading-5 text-white transition-colors duration-200 transform bg-blue-500 rounded-md hover:bg-blue-600 focus:outline-none focus:bg-gray-600">Sign Up</button>
                    </div>
                    <div class="flex justify-center mt-4">
                        <p class="text-sm text-gray-700">Already have an account? 
                            <a href="{% url 'login_page' %}" class="text-blue-500 hover:text-blue-600">Login</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </section>
<!-- Bootstrap JS (Optional but recommended for interactive components) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- Toastr JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tabler/icons@1.74.0/icons-react/dist/index.umd.min.js"></script>

    <script>

        $(document).ready(function() {
            $('#sign_up').on('click', function(event) {
        
                event.preventDefault();
    
            
                var name = $('#name').val();
                var contact1 = $('#contact1').val();
                var contact2 = $('#contact2').val();
                var password = $('#password').val();
                var password2 = $('#confirm_password').val();
                var email = $('#email').val();
                var dc_code = $('#dc_Code').val();
                var date_of_birth = $('#date_of_birth').val();
                var occupation = $('#occupation').val();
                var ip_address = $('#systemipaddress').val();
                var course_name = $('#course_name').val();
                var college_name = $('#college_name').val();
                var company_name = $('#company_name').val();
                var pan_number = $('#pan_card_number').val();
                
        
                if (!name || !contact1 || !email || !password || !password2 || !contact2 || !dc_Code || !date_of_birth || !pan_number) {
                    return;
                }
        
                // Create a FormData object
                var formData = new FormData();
        
                // Append form data manually
                formData.append('name', name);
                formData.append('contact1', contact1);
                formData.append('contact2', contact2);
                formData.append('email', email);
                formData.append('password', password);
                formData.append('password2', password2);
                formData.append('dc_code', dc_code);
                formData.append('occupation',occupation);
                formData.append('ip_address',ip_address);
                formData.append('date_of_birth',date_of_birth);
                formData.append('course_name',course_name);
                formData.append('college_name',college_name);
                formData.append('company_name',company_name);
                formData.append('pan_number',pan_number);

                
                
                
                const fileInputs = ['captured-image-file','aadhar_front','aadhar_back','pan_card']
                    fileInputs.forEach((fileInputId)=>{
    
                    var fileInput = document.getElementById(fileInputId);
    
                if (fileInput.files.length > 0) {
                    formData.append(fileInputId, fileInput.files[0]);
                }
                    })
                
        
                // Send data via AJAX
                $.ajax({
                    url: '/V2_DCEMI/signup_api/',
                    type: 'POST',
                    data: formData,
                    processData: false, 
                    contentType: false,
                    success: function(response) {
                        toastr.success('Registration successful!', 'Success');
        
                        const inputFields = ["name", "contact1","contact2","email", "password", "password2", "dc_Code","date_of_birth",'occupation','ip_address','course_name','college_name','company_name'];
                        inputFields.forEach(fieldId => {
                            document.getElementById(fieldId).value = "";
                            localStorage.removeItem(fieldId);
                        });
                    },
                    error: function(xhr) {
                        var errors = xhr.responseJSON;
                        var firstKey = Object.keys(errors)[0];
                        var firstError = errors[firstKey][0];
                        toastr.error(firstError, 'Error');
                    }
                });
            });
        
           
        
            // Fetch IP address
            function fetchIPAddress() {
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('systemipaddress').value = data.ip;
                    })
                    .catch(error => {
                        console.error('Error fetching IP address:', error);
                    });
            }
        
            window.onload = fetchIPAddress;
    
        });
    
    
    
        document.getElementById('occupation').addEventListener('change', function () {
            var occupationValue = this.value;
            var dynamicFields = document.getElementById('dynamicFields');
           

            dynamicFields.innerHTML = ''; // Clear existing dynamic fields

            if (occupationValue === '1') { // Student selected
                 dynamicFields.style.display = "block"
                dynamicFields.innerHTML = `
                    <div>
                        <label class="text-gray-700" for="course_name">Course Name</label>
                        <input id="course_name" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                    </div>
                    <div>
                        <label class="text-gray-700" for="college_name">College Name</label>
                        <input id="college_name" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                    </div>
                `;
            } else if (occupationValue === '2') { // Salaried selected
                 dynamicFields.style.display = "block"
                dynamicFields.innerHTML = `
                    <div>
                        <label class="text-gray-700" for="company_name">Business Name</label>
                        <input id="company_name" type="text" class="form-input text-gray-700/80 block w-full rounded-md py-2 px-4 mt-2 bg-white border border-gray-300 focus:ring-transparent focus:border-gray-700/25">
                    </div>
                `;
            }
            else if (occupationValue === '3') { // Salaried selected
                dynamicFields.style.display = "none"
               
           }
           else if (occupationValue === '4') { // Salaried selected
            dynamicFields.style.display = "none"
           
       }
       else if (occupationValue === '0') { // Salaried selected
        dynamicFields.style.display = "none"
       
   }
        });


        window.addEventListener('load', function () {
            document.getElementById('spinner-overlay').style.display = 'none';
            document.getElementById('content').style.display = 'block';
          });

    </script>
</body>


</html>